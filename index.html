<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>SAO: Text Adventure (Demo)</title>
  <link rel="stylesheet" href="css/styles.css?v=1.6" />
  <link rel="stylesheet" href="css/combat-styles.css" />
  <link rel="stylesheet" href="css/battle-screen.css?v=1.5" />
  <script src="js/battle-adapter.js"></script>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="loading-panel">
      <div class="loading-logo">
        <div class="logo-icon">‚öîÔ∏è</div>
        <div class="logo-text">SWORD ART ONLINE</div>
        <div class="logo-subtitle">Text Adventure</div>
      </div>
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
      </div>
      <div class="loading-tip">Initializing game systems...</div>
    </div>
  </div>

  <!-- Mobile-optimized game container -->
  <div id="game-container">
    <!-- Compact sticky HUD (mobile-first, minimal clutter) -->
    <div id="top-hud" class="hud" aria-label="Player HUD">
      <div class="hud-left">
        <span id="hud-name">Player</span> ¬∑ Lv <span id="hud-level">1</span> ¬∑ F<span id="hud-floor">1</span>
      </div>
      <div class="hud-mid" aria-hidden="false">
        <div class="hud-bar hp" title="HP">
          <div id="hud-hp-bar" style="width:50%"></div>
        </div>
        <div class="hud-bar xp" title="XP">
          <div id="hud-xp-bar" style="width:10%"></div>
        </div>
      </div>
      <div class="hud-right">
        <button id="hud-save-btn" class="hud-icon-btn" title="Save Game">üíæ</button>
        üí∞ <span id="hud-gold">0</span>G
      </div>
    </div>
    <!-- Top: Scrollable Adventure Log -->
    <div id="adventure-log">
      <header>
        <h1>SAO ‚Äî Text Adventure</h1>
      </header>
      
      <!-- Player Status (compact for mobile) -->
      <div id="status" class="card">
        <h2>Player Status</h2>
        <div id="player-name">Player</div>
        <div class="stat">Lv <span id="player-level">1</span> | HP <span id="player-hp">10</span>/<span id="player-maxhp">10</span></div>
        <div class="bar-wrap"><div class="bar-outer"><div id="hp-bar" class="bar-inner"></div></div></div>
        <div class="stat">XP <span id="player-xp">0</span>/<span id="player-nextxp">100</span> | Floor <span id="player-floor">1</span> | üí∞ <span id="player-gold">0</span>G</div>
        <div class="bar-wrap"><div class="bar-outer"><div id="xp-bar" class="bar-inner"></div></div></div>
        <div class="stat" id="dungeon-progress-display" style="display:none;">üè∞ Dungeon: <span id="dungeon-progress">0</span>/<span id="dungeon-rooms">0</span> rooms</div>
        <details class="stat-details">
          <summary>Stats & Equipment</summary>
          <div class="stat">Atk: <span id="player-atk">2</span> | Def: <span id="player-def">1</span> | Dex: <span id="player-dex">1</span> | Luck: <span id="player-luck">0</span></div>
          <div class="stat">Archetype: <span id="player-archetype">None</span> <button id="btn-archetype" class="small-btn">Choose</button></div>
          <div id="equip-preview" class="equip-preview" style="display:none"></div>
          <!-- Faction Reputation (kept inside details to avoid clutter) -->
          <div class="stat"><strong>Factions:</strong> Faune <span id="rep-faune">0</span> | Fae <span id="rep-fae">0</span> | Merchants <span id="rep-merchants">0</span></div>
          <div class="stat">Quests: <span id="quest-count">0</span> | Achievements: <span id="achievement-count">0</span>/<span id="achievement-total">30</span></div>
          <div class="stat">Points: <span id="player-points">0</span> | Tokens: <span id="player-tokens">0</span> | SP: <span id="player-skillpoints">0</span></div>
          <div class="stat">
            <button id="btn-skills" class="small-btn">Skills</button>
            <button id="btn-allocate-skills" class="small-btn" style="display:none">Allocate SP</button>
            <button id="btn-allocate-stats" class="small-btn" style="display:none">Allocate Stats</button>
            <button id="btn-achievements" class="small-btn">Achievements</button>
            <button id="quick-heal" class="small-btn">Use Herb</button>
          </div>
        </details>
      </div>

      <!-- Quest Tracker (collapsible on mobile) -->
      <details id="quest-tracker-mobile" class="card">
        <summary><h2>Active Quests (<span id="quest-count-display">0</span>)</h2></summary>
        <div id="quest-tracker-list"></div>
      </details>

      <!-- Action Log -->
      <div id="log" class="card">
        <h2>Adventure Log</h2>
        <div id="log-entries" class="log-entries" role="log" aria-live="polite" aria-atomic="false"></div>
      </div>

      <!-- Inventory Toggle Button -->
      <button id="inventory-toggle-button" class="inventory-toggle-btn" aria-label="Open Inventory">
        üéí Inventory
      </button>

      <!-- Full Screen Inventory Panel (initially hidden) -->
      <div id="inventory-panel" class="inventory-panel" style="display: none;">
        <div class="inventory-container">
          <!-- Inventory Header with Close Button -->
          <div class="inventory-header">
            <h2>Inventory</h2>
            <button id="inventory-close-btn" class="inventory-close-btn" aria-label="Close Inventory">‚úï</button>
          </div>

          <!-- Category Tabs -->
          <div id="inventory-category-tabs" class="inventory-category-tabs">
            <button id="tab-all" class="inventory-tab active" data-category="all">All</button>
            <button id="tab-equipment" class="inventory-tab" data-category="equipment">Equipment</button>
            <button id="tab-consumables" class="inventory-tab" data-category="consumable">Consumables</button>
            <button id="tab-materials" class="inventory-tab" data-category="resource">Materials</button>
            <button id="tab-quest" class="inventory-tab" data-category="quest">Quest Items</button>
          </div>

          <!-- Item List -->
          <ul id="inventory-list" class="inventory-list"></ul>

          <!-- Item Detail Panel (initially hidden) -->
          <div id="item-detail-panel" class="item-detail-panel" style="display: none;">
            <div class="item-detail-content">
              <h3 id="item-detail-name"></h3>
              <p id="item-detail-description"></p>
              <p id="item-detail-stats"></p>
              <p id="item-detail-quantity"></p>
              
              <!-- Dynamic Action Buttons Container -->
              <div id="item-detail-actions" class="item-detail-actions"></div>
              
              <button id="item-detail-close" class="btn-secondary">Close</button>
            </div>
          </div>
        </div>
        <div id="inventory-badge" aria-hidden="true" class="new-badge" style="display:none">New</div>
      </div>

      <!-- Quests List (collapsible) -->
      <details id="quests-mobile" class="card">
        <summary><h2>Quest Log</h2></summary>
        <ul id="quest-list"></ul>
        <div id="quest-progress-bars"></div>
      </details>
    </div>

    <!-- Bottom: Fixed Command Panel -->
    <div id="command-panel">
      <div class="actions" id="main-actions">
        <button id="btn-field">Explore Field</button>
        <button id="btn-dungeon">Explore Dungeon</button>
        <button id="btn-town">Town</button>
        <button id="btn-npc">NPCs</button>
      </div>
      
      <div class="actions" id="town-actions" style="display:none;">
        <button id="btn-blacksmith">Blacksmith</button>
        <button id="btn-market">Market</button>
        <button id="btn-boss-arena">Boss Arena</button>
        <button id="btn-travel">Travel</button>
        <button id="btn-storage">Storage</button>
        <button id="btn-quest-board">Quests</button>
        <button id="btn-field-return">Leave Town</button>
      </div>
      
      <div class="actions combat-actions" id="combat-actions" style="display:none;">
        <button id="btn-attack">Attack</button>
        <button id="btn-skill-combat">Skill</button>
        <button id="btn-use-item">Item</button>
        <button id="btn-defend">Defend</button>
        <button id="btn-flee">Flee</button>
      </div>

      <div class="command-footer">
        <button id="btn-rest" class="utility-btn">Rest</button>
        <button id="btn-save" class="utility-btn">Save</button>
        <button id="btn-load" class="utility-btn">Load</button>
        <button id="btn-new-game" class="utility-btn" title="Start a new game (clears current save)">New Game</button>
        <label class="auto-explore-toggle">
          <input type="checkbox" id="auto-explore" /> Auto
        </label>
      </div>
    </div>
  </div>

  <!-- Achievement Popup -->
  <div id="achievement-popup" class="achievement-popup">
    <div class="achievement-icon">üèÜ</div>
    <div class="achievement-content">
      <div class="achievement-title">Achievement Unlocked!</div>
      <div class="achievement-name"></div>
      <div class="achievement-desc"></div>
      <div class="achievement-reward">+50 Gold</div>
    </div>
  </div>

  <!-- Combo Overlay -->
  <div id="combo-overlay" class="combo-overlay">
    <div class="combo-text"></div>
  </div>

  <!-- ============================================
       OLD COMBAT UI - COMMENTED OUT FOR REPLACEMENT
       ============================================ -->
  <!-- 
  <div id="combat-stage" class="combat-stage" style="display:none;">
    <div id="combat-log-overlay" class="combat-log-overlay">
      <div id="combat-log-entries" class="combat-log-entries"></div>
    </div>

    <div id="player-combatant" class="combatant player-side">
      <div class="combatant-sprite player-sprite">‚öîÔ∏è</div>
      <div class="combatant-info">
        <div class="combatant-name" id="player-combat-name">Player</div>
        <div class="stat-bar-row">
          <div class="stat-bar-label">HP</div>
          <div class="stat-bar hp-bar">
            <div class="stat-bar-fill" id="player-combat-hp-bar" style="width:100%"></div>
            <div class="stat-bar-text" id="player-combat-hp-text">100/100</div>
          </div>
        </div>
        <div class="stat-bar-row">
          <div class="stat-bar-label">SP</div>
          <div class="stat-bar sp-bar">
            <div class="stat-bar-fill" id="player-combat-sp-bar" style="width:100%"></div>
            <div class="stat-bar-text" id="player-combat-sp-text">50/50</div>
          </div>
        </div>
        <div class="status-icons" id="player-status-icons"></div>
      </div>
    </div>

    <div id="enemy-combatant" class="combatant enemy-side">
      <div class="combatant-sprite enemy-sprite">üëπ</div>
      <div class="combatant-info">
        <div class="combatant-name" id="enemy-combat-name">Enemy</div>
        <div class="stat-bar-row">
          <div class="stat-bar-label">HP</div>
          <div class="stat-bar hp-bar enemy-hp">
            <div class="stat-bar-fill" id="enemy-combat-hp-bar" style="width:100%"></div>
            <div class="stat-bar-text" id="enemy-combat-hp-text">80/80</div>
          </div>
        </div>
        <div class="enemy-intent" id="enemy-intent">
          <span class="intent-icon">‚öîÔ∏è</span>
          <span class="intent-text">Preparing...</span>
        </div>
        <div class="status-icons" id="enemy-status-icons"></div>
      </div>
    </div>

    <div id="turn-indicator" class="turn-indicator">
      <div class="turn-text">YOUR TURN</div>
    </div>

    <div id="damage-numbers" class="damage-numbers"></div>
  </div>
  -->

  <!-- ============================================
       NEW PROFESSIONAL BATTLE SCREEN
       ============================================ -->
  <div id="battle-screen-container" class="battle-screen-container" style="display:none;">
    <!-- Atmospheric Background Layer -->
    <div id="battle-background" class="battle-background"></div>

    <!-- Top Info Banner (Combat Log) -->
    <div id="top-info-banner" class="top-info-banner">
      <div id="battle-log-text" class="battle-log-text">The battle begins!</div>
    </div>

    <!-- Player Character Display (Left Side) -->
    <div id="player-display" class="player-display">
      <!-- Character Art with Image Support -->
      <div id="player-character-art" class="player-character-art">
        <!-- Actual character image (hidden until loaded) -->
        <img id="player-char-img" class="character-image" src="assets/player_kirito.png" alt="Player Character" style="display:none;" onerror="this.style.display='none';" onload="this.style.display='block'; this.parentElement.querySelector('.character-placeholder').style.display='none';">
        <!-- Fallback placeholder (shown if image fails) -->
        <div class="character-placeholder">
          <span class="character-icon">‚öîÔ∏è</span>
          <div class="character-label" id="player-character-label">KIRITO</div>
        </div>
      </div>
      
      <!-- Underbar directly beneath player art -->
      <div id="player-underbar" class="underbar player-underbar">
        <div class="underbar-fill" id="player-under-hp-bar" style="width:100%"></div>
        <div class="underbar-text" id="player-under-hp-text">100/100</div>
      </div>
      
      <!-- Player Stats Overlay -->
      <div id="player-stats-overlay" class="player-stats-overlay">
        <!-- HP Bar -->
        <div class="stat-display hp-display">
          <div class="stat-label">HP</div>
          <div class="stat-bar-frame">
            <div id="player-hp-bar" class="stat-bar-fill hp-fill" style="width:100%"></div>
            <div id="player-hp-text" class="stat-bar-value">450/600</div>
          </div>
        </div>
        
        <!-- SP Bar -->
        <div class="stat-display sp-display">
          <div class="stat-label">SP</div>
          <div class="stat-bar-frame">
            <div id="player-sp-bar" class="stat-bar-fill sp-fill" style="width:100%"></div>
            <div id="player-sp-text" class="stat-bar-value">50/50</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enemy Character Display (Right Side) -->
    <div id="enemy-display" class="enemy-display">
      <!-- Enemy Art with Image Support -->
      <div id="enemy-character-art" class="enemy-character-art">
        <!-- Actual enemy image (dynamically set by JS) -->
        <img id="enemy-char-img" class="character-image" src="" alt="Enemy Character" style="display:none;" onerror="this.style.display='none';" onload="this.style.display='block'; this.parentElement.querySelector('.character-placeholder').style.display='none';">
        <!-- Fallback placeholder (shown if image fails or not set) -->
        <div class="character-placeholder enemy-placeholder">
          <span class="character-icon">üêó</span>
          <div class="character-label enemy-label">FRENZY BOAR</div>
        </div>
      </div>
      
      <!-- Underbar directly beneath enemy art -->
      <div id="enemy-underbar" class="underbar enemy-underbar">
        <div class="underbar-fill" id="enemy-under-hp-bar" style="width:100%"></div>
        <div class="underbar-text" id="enemy-under-hp-text">100%</div>
      </div>
      
      <!-- Enemy Stats Overlay -->
      <div id="enemy-stats-overlay" class="enemy-stats-overlay">
        <div id="enemy-name-level" class="enemy-name-level">Frenzy Boar LVL 12</div>
        
        <!-- Enemy HP Bar with Percentage -->
        <div class="stat-display hp-display enemy-hp-display">
          <div class="stat-bar-frame">
            <div id="enemy-hp-bar" class="stat-bar-fill enemy-hp-fill" style="width:100%"></div>
            <div id="enemy-hp-percentage" class="stat-bar-value">100%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Combo Meter Display -->
    <div id="combo-meter" class="combo-meter">
      <div class="combo-label">COMBO</div>
      <div class="combo-value">x1</div>
    </div>

    <!-- Player Action Menu (Bottom Bar) -->
    <div id="player-action-menu" class="player-action-menu">
      <button id="attack-btn" class="action-btn attack-btn">
        <span class="btn-icon">‚öîÔ∏è</span>
        <span class="btn-text">ATTACK</span>
      </button>
      <button id="skills-btn" class="action-btn skills-btn">
        <span class="btn-icon">‚ú®</span>
        <span class="btn-text">SKILLS</span>
      </button>
      <button id="items-btn" class="action-btn items-btn">
        <span class="btn-icon">üß™</span>
        <span class="btn-text">ITEMS</span>
      </button>
      <button id="defend-btn" class="action-btn defend-btn">
        <span class="btn-icon">üõ°Ô∏è</span>
        <span class="btn-text">DEFEND</span>
      </button>
      <button id="run-btn" class="action-btn run-btn">
        <span class="btn-icon">üèÉ</span>
        <span class="btn-text">RUN</span>
      </button>
    </div>

    <!-- "YOUR TURN" Overlay Indicator -->
    <div id="turn-indicator" class="turn-indicator-new">
      <div class="turn-text-new">YOUR TURN</div>
    </div>

    <!-- Damage Numbers Container -->
    <div id="damage-numbers" class="damage-numbers-new"></div>

    <!-- Decorative UI Frames -->
    <div class="ui-frame-corners">
      <div class="corner-tl"></div>
      <div class="corner-tr"></div>
      <div class="corner-bl"></div>
      <div class="corner-br"></div>
    </div>
  </div>

  <!-- Modal for NPCs and dialogs -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-panel card" role="dialog" aria-modal="true">
      <div class="modal-header"><h3 id="modal-title"></h3></div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-actions" id="modal-actions"></div>
    </div>
  </div>

  <!-- Equipment panel (shows equipped items per slot) -->
  <template id="equipment-template">
    <div id="equipment" class="card">
      <h2>Equipment</h2>
      <div id="equipment-slots" class="equipment-slots">
        <!-- slot items rendered here -->
      </div>
      <div class="help">Equip items to increase ATK/DEF. Use the inventory to equip/unequip.</div>
    </div>
  </template>

  <script src="js/config.js?v=1.4"></script>
  <script src="js/enemies.js?v=1.4"></script>
  <script src="js/npcs.js?v=1.4"></script>
  <script src="js/achievements.js?v=1.4"></script>
  <script src="js/inventory.js?v=1.4"></script>
  <script src="js/main.js?v=1.6"></script>
</body>
</html>